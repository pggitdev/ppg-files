<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal - บันทึกการเทรด</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- D3.js CDN for charts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Firebase Libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, where, doc, setDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // กำหนดให้แสดง Log สำหรับการดีบั๊ก
        setLogLevel('debug');

        // Global variables ที่มีให้จาก Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth, db, userId;
        let tradeIdToDelete = null;

        const initFirebase = async () => {
            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is missing. Please provide it in the environment variables.");
                return;
            }
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // ตรวจสอบและลงชื่อเข้าใช้ด้วย token ที่ให้มา หรือลงชื่อแบบไม่ระบุตัวตน
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id').textContent = userId;
                        console.log("Logged in with user ID:", userId);
                        attachRealtimeListener(userId);
                    } else {
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (error) {
                            console.error("Authentication failed:", error);
                        }
                    }
                });
            } catch (error) {
                console.error("Failed to initialize Firebase:", error);
            }
        };

        // ฟังก์ชันสำหรับแนบ Listener เพื่ออัปเดตข้อมูลแบบเรียลไทม์
        const attachRealtimeListener = (uid) => {
            const collectionPath = `/artifacts/${appId}/users/${uid}/trades`;
            const q = query(collection(db, collectionPath));

            onSnapshot(q, (snapshot) => {
                const trades = [];
                snapshot.forEach((doc) => {
                    trades.push({ id: doc.id, ...doc.data() });
                });
                updateUI(trades);
            }, (error) => {
                console.error("Failed to fetch data:", error);
            });
        };

        // ฟังก์ชันสำหรับบันทึกข้อมูลการเทรด
        window.saveTrade = async (event) => {
            event.preventDefault();
            const form = event.target;
            const tradeData = {
                date: form.date.value,
                pair: form.pair.value.toUpperCase(),
                entry: parseFloat(form.entry.value),
                tp: parseFloat(form.tp.value),
                sl: parseFloat(form.sl.value),
                result: form.result.value,
                profit: parseFloat(form.profit.value),
                lotSize: parseFloat(form.lotSize.value),
                reason: form.reason.value,
                timestamp: new Date().toISOString()
            };

            if (!userId) {
                console.error("User is not authenticated. Cannot save data.");
                return;
            }

            try {
                const collectionPath = `/artifacts/${appId}/users/${userId}/trades`;
                await addDoc(collection(db, collectionPath), tradeData);
                console.log("Trade saved successfully!");
                form.reset();
                showStatusMessage('บันทึกข้อมูลเรียบร้อยแล้ว!', 'success');
            } catch (e) {
                console.error("Error adding document: ", e);
                showStatusMessage('เกิดข้อผิดพลาดในการบันทึกข้อมูล', 'error');
            }
        };

        // ฟังก์ชันสำหรับอัปเดต UI ด้วยข้อมูลใหม่
        const updateUI = (trades) => {
            const totalTrades = trades.length;
            const wins = trades.filter(t => t.result === 'win').length;
            const losses = totalTrades - wins;
            const winRate = totalTrades > 0 ? ((wins / totalTrades) * 100).toFixed(2) : 0;
            const totalProfit = trades.reduce((sum, t) => sum + (t.profit || 0), 0).toFixed(2);
            
            // Lot Size Analysis
            const lotSizes = trades.filter(t => t.lotSize != null).map(t => t.lotSize);
            const isFixedLot = lotSizes.length > 1 && lotSizes.every(lot => lot === lotSizes[0]);
            const averageLot = lotSizes.length > 0 ? (lotSizes.reduce((sum, lot) => sum + lot, 0) / lotSizes.length).toFixed(2) : 0;

            document.getElementById('total-trades').textContent = totalTrades;
            document.getElementById('win-rate').textContent = `${winRate}%`;
            document.getElementById('total-profit').textContent = `${totalProfit} $`;
            document.getElementById('total-profit').style.color = totalProfit >= 0 ? 'green' : 'red';
            
            document.getElementById('is-fixed-lot').textContent = isFixedLot ? 'ใช่' : 'ไม่ใช่';
            document.getElementById('average-lot').textContent = averageLot;

            const tableBody = document.getElementById('trade-table-body');
            tableBody.innerHTML = '';
            trades.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); // เรียงลำดับจากใหม่ไปเก่า

            trades.forEach(trade => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-4">${new Date(trade.date).toLocaleDateString('th-TH')}</td>
                    <td class="p-4">${trade.pair}</td>
                    <td class="p-4">${trade.lotSize}</td>
                    <td class="p-4">${trade.entry}</td>
                    <td class="p-4">${trade.tp}</td>
                    <td class="p-4">${trade.sl}</td>
                    <td class="p-4 ${trade.result === 'win' ? 'text-green-600 font-medium' : 'text-red-600 font-medium'}">${trade.result === 'win' ? 'ชนะ' : 'แพ้'}</td>
                    <td class="p-4 ${trade.profit >= 0 ? 'text-green-600' : 'text-red-600'}">${trade.profit.toFixed(2)}</td>
                    <td class="p-4 text-sm max-w-xs overflow-hidden truncate whitespace-normal">${trade.reason}</td>
                    <td class="p-4 text-center">
                        <button onclick="showDeleteConfirm('${trade.id}')" class="text-red-500 hover:text-red-700 transition duration-150 transform hover:scale-110">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 112 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Render charts
            renderProfitChart(trades);
        };

        // ฟังก์ชันสำหรับแสดงหน้าต่างยืนยันการลบ
        window.showDeleteConfirm = (tradeId) => {
            tradeIdToDelete = tradeId;
            document.getElementById('delete-modal').classList.remove('hidden');
        };

        // ฟังก์ชันสำหรับยืนยันการลบ
        window.confirmDelete = async () => {
            document.getElementById('delete-modal').classList.add('hidden');
            if (!tradeIdToDelete) return;
            
            if (!userId) {
                console.error("User is not authenticated. Cannot delete data.");
                showStatusMessage('กรุณาเข้าสู่ระบบก่อนลบข้อมูล', 'error');
                return;
            }

            try {
                const collectionPath = `/artifacts/${appId}/users/${userId}/trades`;
                const docRef = doc(db, collectionPath, tradeIdToDelete);
                await deleteDoc(docRef);
                showStatusMessage('ลบข้อมูลเรียบร้อยแล้ว!', 'success');
            } catch (e) {
                console.error("Error deleting document: ", e);
                showStatusMessage('เกิดข้อผิดพลาดในการลบข้อมูล', 'error');
            } finally {
                tradeIdToDelete = null;
            }
        };

        // ฟังก์ชันสำหรับยกเลิกการลบ
        window.cancelDelete = () => {
            document.getElementById('delete-modal').classList.add('hidden');
            tradeIdToDelete = null;
        };

        // ฟังก์ชันสำหรับส่งออกข้อมูล
        window.exportData = () => {
            if (!userId) {
                console.error("User is not authenticated. Cannot export data.");
                showStatusMessage('กรุณาเข้าสู่ระบบก่อนส่งออกข้อมูล', 'error');
                return;
            }
            const collectionPath = `/artifacts/${appId}/users/${userId}/trades`;
            getDocs(collection(db, collectionPath)).then(snapshot => {
                const trades = [];
                snapshot.forEach(doc => {
                    trades.push(doc.data());
                });

                if (trades.length === 0) {
                    showStatusMessage('ไม่มีข้อมูลให้ส่งออก', 'info');
                    return;
                }

                const headers = ["วันที่", "คู่เงิน", "ล็อต", "จุดเข้า", "TP", "SL", "ผล", "กำไร", "เหตุผล"];
                const csvRows = [headers.join(',')];
                
                trades.forEach(trade => {
                    const row = [
                        new Date(trade.date).toLocaleDateString('th-TH'),
                        trade.pair,
                        trade.lotSize,
                        trade.entry,
                        trade.tp,
                        trade.sl,
                        trade.result === 'win' ? 'ชนะ' : 'แพ้',
                        trade.profit,
                        `"${trade.reason.replace(/"/g, '""')}"`
                    ];
                    csvRows.push(row.join(','));
                });

                const csvString = csvRows.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "trading_journal.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showStatusMessage('ส่งออกข้อมูลเรียบร้อยแล้ว!', 'success');
            }).catch(e => {
                console.error("Export failed:", e);
                showStatusMessage('การส่งออกข้อมูลล้มเหลว', 'error');
            });
        };

        // ฟังก์ชันสำหรับนำเข้าข้อมูล (อัปโหลดไฟล์ CSV)
        window.importData = (event) => {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            if (!userId) {
                console.error("User is not authenticated. Cannot import data.");
                showStatusMessage('กรุณาเข้าสู่ระบบก่อนนำเข้าข้อมูล', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const text = e.target.result;
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    const headers = lines[0].split(',').map(h => h.trim());
                    const dataLines = lines.slice(1);

                    const tradesToImport = [];
                    dataLines.forEach(line => {
                        const values = line.split(',');
                        if (values.length === headers.length) {
                            const tradeData = {
                                date: values[0].trim(),
                                pair: values[1].trim().toUpperCase(),
                                lotSize: parseFloat(values[2].trim()) || 0,
                                entry: parseFloat(values[3].trim()) || 0,
                                tp: parseFloat(values[4].trim()) || 0,
                                sl: parseFloat(values[5].trim()) || 0,
                                result: values[6].trim() === 'ชนะ' ? 'win' : 'loss',
                                profit: parseFloat(values[7].trim()) || 0,
                                reason: values[8].trim().replace(/^"|"$/g, ''),
                                timestamp: new Date().toISOString()
                            };
                            tradesToImport.push(tradeData);
                        }
                    });

                    const collectionPath = `/artifacts/${appId}/users/${userId}/trades`;
                    let successCount = 0;
                    for (const trade of tradesToImport) {
                        await addDoc(collection(db, collectionPath), trade);
                        successCount++;
                    }

                    showStatusMessage(`นำเข้าข้อมูลสำเร็จ ${successCount} รายการ`, 'success');
                } catch (error) {
                    console.error("Error importing data:", error);
                    showStatusMessage('เกิดข้อผิดพลาดในการนำเข้าข้อมูล', 'error');
                }
            };
            reader.readAsText(file);
        };

        // ฟังก์ชันแสดงข้อความสถานะแบบ Modal
        const showStatusMessage = (message, type) => {
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            messageText.textContent = message;
            messageBox.className = `fixed bottom-5 right-5 p-4 rounded-lg shadow-lg z-50 text-white transition-opacity duration-300 ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-gray-500'} opacity-100`;
            setTimeout(() => {
                messageBox.className = `${messageBox.className} opacity-0`;
            }, 3000);
        };

        // ฟังก์ชันสำหรับวาดกราฟกำไรสะสม (กราฟเส้น)
        const renderProfitChart = (trades) => {
            d3.select("#profit-chart").selectAll("*").remove(); // เคลียร์กราฟเก่า

            if (trades.length === 0) {
                d3.select("#profit-chart").append("p").text("ไม่มีข้อมูลการเทรด").attr("class", "text-center text-gray-500 mt-4");
                return;
            }

            const sortedTrades = trades.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            let cumulativeProfit = 0;
            const chartData = sortedTrades.map(trade => {
                cumulativeProfit += trade.profit;
                return { 
                    date: new Date(trade.date), 
                    profit: cumulativeProfit,
                    originalProfit: trade.profit // Store the individual trade profit for labels
                };
            });

            const margin = {top: 40, right: 30, bottom: 30, left: 40};
            const width = 600 - margin.left - margin.right;
            const height = 250 - margin.top - margin.bottom;

            const svg = d3.select("#profit-chart")
                .append("svg")
                .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
                .attr("class", "mx-auto")
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            const x = d3.scaleTime()
                .domain(d3.extent(chartData, d => d.date))
                .range([0, width]);
            
            const y = d3.scaleLinear()
                .domain(d3.extent(chartData, d => d.profit))
                .range([height, 0]);

            const line = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.profit))
                .curve(d3.curveMonotoneX);

            // Add the line path
            svg.append("path")
                .datum(chartData)
                .attr("fill", "none")
                .attr("stroke", "#4C51BF") // Indigo
                .attr("stroke-width", 2)
                .attr("d", line);

            // Add circles for data points
            svg.selectAll(".dot")
                .data(chartData)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(d.date))
                .attr("cy", d => y(d.profit))
                .attr("r", 4) // Radius of the circle
                .attr("fill", "#4C51BF");

            // Add profit/loss labels
            svg.selectAll(".label")
                .data(chartData)
                .enter().append("text")
                .attr("class", "label")
                .attr("x", d => x(d.date))
                .attr("y", d => y(d.profit) - 10) // Position the label above the dot
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#333")
                .text(d => d.originalProfit.toFixed(2));

            // Add X-axis
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Add Y-axis
            svg.append("g")
                .call(d3.axisLeft(y));
        };

        // เริ่มต้นการทำงานของ Firebase เมื่อหน้าเว็บโหลดเสร็จ
        window.onload = initFirebase;
    </script>
</head>
<body class="bg-blue-50 text-gray-800 font-sans p-6 md:p-12">
    
    <!-- Status Message Box -->
    <div id="message-box" class="fixed bottom-5 right-5 p-4 rounded-lg shadow-lg z-50 transition-opacity duration-300 opacity-0">
        <p id="message-text"></p>
    </div>

    <!-- Confirmation Modal for Deletion -->
    <div id="delete-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex justify-center items-center">
        <div class="relative p-6 border w-96 shadow-lg rounded-xl bg-white text-center transform transition-all duration-300 scale-100">
            <h3 class="text-xl font-bold text-gray-900">ยืนยันการลบ</h3>
            <p class="text-gray-600 mt-2">คุณแน่ใจหรือไม่ว่าต้องการลบรายการเทรดนี้? การกระทำนี้ไม่สามารถย้อนกลับได้</p>
            <div class="mt-6 flex justify-center space-x-4">
                <button onclick="confirmDelete()" class="px-5 py-2 text-white bg-red-600 rounded-lg shadow-md hover:bg-red-700 transition duration-150">
                    ลบ
                </button>
                <button onclick="cancelDelete()" class="px-5 py-2 text-gray-700 bg-gray-200 rounded-lg shadow-md hover:bg-gray-300 transition duration-150">
                    ยกเลิก
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
        
        <!-- Header -->
        <header class="bg-blue-600 text-white p-6 md:p-8 rounded-t-3xl shadow-inner">
            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Trading Journal</h1>
            <p class="mt-1 text-blue-200">บันทึกการเทรดของคุณให้เป็นระบบ</p>
            <p class="mt-2 text-sm text-blue-300">
                <span class="font-semibold">User ID:</span> 
                <span id="user-id" class="break-all">...loading...</span>
            </p>
        </header>

        <!-- Dashboard Section -->
        <section class="p-6 md:p-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Total Trades Card -->
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-100">
                    <h3 class="text-xl font-semibold text-blue-700">จำนวนการเทรดทั้งหมด</h3>
                    <p id="total-trades" class="mt-2 text-4xl font-bold text-gray-900">0</p>
                </div>
                <!-- Win Rate Card -->
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-100">
                    <h3 class="text-xl font-semibold text-blue-700">อัตราการชนะ (Win Rate)</h3>
                    <p id="win-rate" class="mt-2 text-4xl font-bold text-gray-900">0%</p>
                </div>
                <!-- Total Profit Card -->
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-100">
                    <h3 class="text-xl font-semibold text-blue-700">กำไรสุทธิ</h3>
                    <p id="total-profit" class="mt-2 text-4xl font-bold text-gray-900">0.00 $</p>
                </div>
                <!-- Lot Analysis Card -->
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-100">
                    <h3 class="text-xl font-semibold text-blue-700">การวิเคราะห์ Lot</h3>
                    <p class="mt-2 text-base font-bold text-gray-900">ล็อตคงที่: <span id="is-fixed-lot" class="font-normal text-gray-600">ไม่ใช่</span></p>
                    <p class="mt-1 text-base font-bold text-gray-900">ล็อตเฉลี่ย: <span id="average-lot" class="font-normal text-gray-600">0.00</span></p>
                </div>
            </div>
            
            <hr class="my-8 border-t border-gray-200" />
            
            <!-- Charts Section -->
            <div class="grid grid-cols-1 gap-8">
                <!-- Total Profit Chart -->
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-100">
                    <h3 class="text-xl font-bold text-blue-800 mb-4 text-center">กราฟกำไรสะสม</h3>
                    <div id="profit-chart" class="h-64"></div>
                </div>
            </div>
        </section>

        <!-- Form Section and Trade List -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8 p-6 md:p-8">
            
            <!-- Trade Entry Form -->
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-100">
                    <h2 class="text-2xl font-bold text-blue-800 mb-6">บันทึกรายการเทรดใหม่</h2>
                    <form onsubmit="saveTrade(event)">
                        <!-- Date -->
                        <div class="mb-4">
                            <label for="date" class="block text-sm font-medium text-gray-700">วันที่เข้าออเดอร์</label>
                            <input type="date" id="date" name="date" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
                        </div>
                        <!-- Pair -->
                        <div class="mb-4">
                            <label for="pair" class="block text-sm font-medium text-gray-700">คู่เงิน/สินทรัพย์</label>
                            <input type="text" id="pair" name="pair" placeholder="เช่น XAUUSD, BTCUSD" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
                        </div>
                        <!-- Lot Size -->
                        <div class="mb-4">
                            <label for="lotSize" class="block text-sm font-medium text-gray-700">ล็อตที่เข้า</label>
                            <input type="number" step="any" id="lotSize" name="lotSize" placeholder="เช่น 0.01, 1.00" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
                        </div>
                        <!-- Entry, TP, SL -->
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div>
                                <label for="entry" class="block text-sm font-medium text-gray-700">จุดเข้า</label>
                                <input type="number" step="any" id="entry" name="entry" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
                            </div>
                            <div>
                                <label for="tp" class="block text-sm font-medium text-gray-700">จุด TP</label>
                                <input type="number" step="any" id="tp" name="tp" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
                            </div>
                            <div>
                                <label for="sl" class="block text-sm font-medium text-gray-700">จุด SL</label>
                                <input type="number" step="any" id="sl" name="sl" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
                            </div>
                        </div>
                        <!-- Result -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700">ผลการเทรด</label>
                            <div class="mt-1 flex items-center space-x-6">
                                <label class="flex items-center">
                                    <input type="radio" name="result" value="win" class="form-radio text-green-500" checked>
                                    <span class="ml-2 text-green-600 font-medium">ชนะ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="result" value="loss" class="form-radio text-red-500">
                                    <span class="ml-2 text-red-600 font-medium">แพ้</span>
                                </label>
                            </div>
                        </div>
                        <!-- Profit/Loss -->
                        <div class="mb-4">
                            <label for="profit" class="block text-sm font-medium text-gray-700">กำไร/ขาดทุน ($)</label>
                            <input type="number" step="any" id="profit" name="profit" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
                        </div>
                        <!-- Reason -->
                        <div class="mb-6">
                            <label for="reason" class="block text-sm font-medium text-gray-700">เหตุผลการเข้า/ออก</label>
                            <textarea id="reason" name="reason" rows="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2" placeholder="อธิบายกลยุทธ์, จุดที่มองเห็น หรือบทเรียนที่ได้จากการเทรดครั้งนี้"></textarea>
                        </div>
                        
                        <button type="submit" class="w-full py-3 px-6 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-full shadow-lg transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            บันทึกรายการเทรด
                        </button>
                    </form>
                </div>
            </div>

            <!-- Trade List and Export -->
            <div class="lg:col-span-1">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-blue-800">รายการเทรดทั้งหมด</h2>
                    <div class="flex space-x-2">
                        <label for="import-file" class="py-2 px-4 bg-blue-200 hover:bg-blue-300 text-blue-700 text-sm font-medium rounded-full shadow-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-400 cursor-pointer">
                            อัปโหลด CSV
                        </label>
                        <input type="file" id="import-file" accept=".csv" class="hidden" onchange="importData(event)">
                        <button onclick="exportData()" class="py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded-full shadow-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
                            ส่งออกข้อมูล (CSV)
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-md border border-gray-100 overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-blue-50">
                            <tr>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">วันที่</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">คู่เงิน</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ล็อต</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">จุดเข้า</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">TP</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">SL</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ผล</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">กำไร ($)</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">เหตุผล</th>
                                <th scope="col" class="p-4 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="trade-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Trade rows will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

</body>
</html>
